<include file="./Public/html/header.html" />
<style type="text/css">
<!--
body{font-size:12px;}.l-table-edit-td{padding:10px 20px;}.l-table-edit-td input{width:130px;}.l-button-submit,.l-button-test{width:80px;float:left;margin-left:10px;padding-bottom:2px;}.l-verify-tip{left:230px;top:120px;}.l-table-edit tr td span{color:#f30;padding-left:5px;}.tipmsg{color:#f30;}.tip_msg3{color:#fb072f;}#cate{width:144px;}.image-preview{position:relative;margin-top:16px;}#is_sell{width:56px;}#type{width:144px;}#product_art{width: 144px;}#series{width:144px;}.image-preview-outter{display:block;}.image-preview-delete{display:block;position:absolute;top:0px;left:144px;background:url(/Public/images/delete.png) no-repeat;background-color:#fff;width:16px;height:16px;}#is_top,#is_free_parking{width:56px;}@-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}.progress{height:20px;margin-bottom:20px;overflow:hidden;background-color:#f5f5f5;border-radius:4px;-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);box-shadow:inset 0 1px 2px rgba(0,0,0,0.1)}.progress-bar{float:left;width:0;height:100%;font-size:12px;line-height:20px;color:#fff;text-align:center;background-color:#428bca;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,0.15);box-shadow:inset 0 -1px 0 rgba(0,0,0,0.15);-webkit-transition:width .6s ease;transition:width .6s ease}.progress-striped .progress-bar{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15)25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-size:40px 40px}.progress.active .progress-bar{-webkit-animation:progress-bar-stripes 2s linear infinite;animation:progress-bar-stripes 2s linear infinite}.progress-bar-success{background-color:#5cb85c}.progress-striped .progress-bar-success{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15)25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent)}.progress-bar-info{background-color:#5bc0de}.progress-striped .progress-bar-info{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15)25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent)}.progress-bar-warning{background-color:#f0ad4e}.progress-striped .progress-bar-warning{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15)25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent)}.progress-bar-danger{background-color:#d9534f}.progress-striped .progress-bar-danger{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15)25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent)}
-->
</style>
<div id="main">
    <div id="main-cnt">
        <div id="contentH" class="cnt-box wall" style="padding-left: 0px;">
            <div class="title clearfix">
                <div class="l title-cnt">
                    <span class="icon icon8"></span>APP封面设置
                </div>
            </div>
        </div>
        <div class="top_6">
            <table cellpadding="0" cellspacing="0" class="l-table-edit">
                <tr>
                    <td align="right" class="l-table-edit-td">添加时间：</td>
                    <td align="left" class="l-table-edit-td"><input type="text" style="width:200px;" value="<if condition="$cover['add_time']"><{$cover['add_time']}><else />尚未添加封面图片</if>" readonly /></td>
                    <td align="left" class="tipmsg"></td>
                </tr>
                <tr>
                    <td align="right" class="l-table-edit-td">更新时间：</td>
                    <td align="left" class="l-table-edit-td"><input type="text" style="width:200px;" value="<if condition="$cover['update_time']"><{$cover['update_time']}><else />从未更新封面图片</if>" readonly /></td>
                    <td align="left" class="tipmsg"></td>
                </tr>
                <tr>
                    <td align="right" class="l-table-edit-td"><span>*</span>封面图片：</td>
                    <td align="left" class="l-table-edit-td">
                        <span class="btn btn-success fileinput-button" style="color:#fff;">
                            &nbsp;&nbsp;选择图片
                            <input id="fileupload" type="file" name="files[]" />
                            <input id="image" type="hidden" value="" />
                        </span>
                        <br>
                        <br>
                        <div id="progress" class="progress" style="display:none;">
                            <div class="progress-bar progress-bar-success"></div>
                        </div>
                    </td>
                    <td align="left" class="tipmsg" id="image_tip">
                        <if condition="$cover['image']">
                        <div class="image-preview">
                            <a href="<{$cover['src']}>" target="_blank" title="点击查看原图" class="image-preview-outter">
                                <img src="<{$cover['image']}>" width="160" height="90" border="0" />
                            </a>
                            <a href="javascript:void(0);" onclick="delete_image('<{$cover['image']}>', $(this));" class="image-preview-delete" title="删除">
                            </a>
                        </div>
                        </if>
                    </td>
                </tr>
            </table>
        </div>
        <div style="clear:both;margin-top:24px;text-align:center;"><input class="btn btn-primary" type="button" value="保存" onclick="javascript:save();" /></div>
    </div>
</div>
<script type="text/javascript">
//<![CDATA[
$(function() {
    $('#fileupload').fileupload({
        acceptFileTypes : /(\.|\/)(jpe?g|png)$/i,
        maxFileSize : 2097152,
        minFileSize : 1,
        url : '<{:U("setting/upload")}>',
        dataType : 'json',
        send: function(e, data) {
            $("#progress").show();
        },
        done: function(e, data) {
            if (data.result.status) {
                $("#progress").hide();
                $("#image_tip").html("<div class='image-preview'>"
                                        + "<a href='"+data.result.src+"' target='_blank' title='点击查看原图' class='image-preview-outter'>"
                                        + "<img src='"+data.result.src+"' width='160' height='90' border='0' />"
                                        + "</a>"
                                        + "<a href='javascript:void(0);' onclick=\"delete_image(\'"
                                        + data.result.filename
                                        + "\', $(this));\" class='image-preview-delete' title='删除'>"
                                        + "</a>"
                                        + "</div>");
                $("#image").val(data.result.filename);
            } else {
                $("#image_tip").html(data.result.msg);
            }
        },
        progressall : function(e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css('width', progress + '%');
        }
    });
});

//删除图片
function delete_image(filename, obj) {
    $.post('<{:U("advertisement/delete_image")}>', {
        filename : filename
    }, function(data) {
        if (data.status) {
            obj.parent().remove();
            $("#image").val('');
        } else {
            $.ligerDialog.alert(data.msg, '出错了(>_<)', 'error');
            return false;
        }
    }, 'json');
}

//保存
function save() {
    var image = $.trim($("#image").val());
    if (image.length <= 0) {
        $.ligerDialog.alert('请上传一张图片', '温馨提示', 'warn');
        return false;
    }
    $.post("<{:U('setting/cover')}>", {image: image}, function(data) {
        if (data.status) {
            $.ligerDialog.alert(data.msg, '成功了(^_^)', 'success');
            location.reload(true);
        } else {
            $.ligerDialog.alert(data.msg, '出错了(>_<)', 'error');
            return false;
        }
    }, 'json');
}
//]]>
</script>
<include file="./Public/html/footer.html" />